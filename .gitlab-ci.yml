include:
  #  remote: https://gitlab.com/group11254/test5/-/raw/main/.gitlab-ci.yml
   - project: "group11254/test5"
     ref: main
     file: "/yml/.gitlab-ci.yaml"
     rules: ## Optional, to show the support to **rules**
     - if: $variable == "condition "
stages:
- build-push
- deploy
image: venerayan/jvm:latest
variables:
DOCKER_PASS: $DOCKER_PASS
#services:
#- docker:19.03.12-dind
build-push:
stage: build-push
before_script:
  - echo "$SERVICE_ACCOUNT_KEY" > key.json
  - docker login -u venerayan -p $DOCKER_PASS
script:
  - ./gradlew build 
  - docker build --tag veneraya/jvm:latest .
  - docker push venerayan/jvm:latest
tags:
  - test-runner
deploy:
stage: deploy
image: venerayan/jvm:latest
script:
# Authenticate with GKE
  - echo "$SERVICE_ACCOUNT_KEY" > key.json
  - gcloud auth activate-service-account --key-file=key.json
  - kubectl apply -f ./kube/*.yaml
tags:
  - test-runner
#view raw.gitlab-ci1.yml hosted with ‚ù§ by GitHub